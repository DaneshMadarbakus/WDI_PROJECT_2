"use strict";console.log("where ya need to go homie?");var Transit=Transit||{},google=google;Transit.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".mainMap").on("click",this.mainMap.bind(this)),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),this.$main.on("submit","form",this.handleForm),this.$main.on("click",".newPics",this.mainMap.bind(this)),this.$main.on("click",".morePics",this.morePics.bind(this)),this.getToken()?this.loggedInState():this.loggedOutState()},$(Transit.init.bind(Transit)),Transit.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),this.mainMap()},Transit.loggedOutState=function(){$(".loggedOut").show(),$(".loggedIn").hide(),this.register()},Transit.register=function(n){n&&n.preventDefault(),this.$main.html('\n    <h2>Register</h2>\n    <form method="post" action="/register">\n      <div class="form-group">\n        <input class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="email" name="user[email]" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Register">\n    </form>\n  ')},Transit.login=function(n){n&&n.preventDefault(),this.$main.html('\n    <h2>Login</h2>\n    <form method="post" action="/login">\n      <div class="form-group">\n        <input class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Login">\n    </form>\n  ')},Transit.mainMap=function(n){var t=this;n&&n.preventDefault(),this.$main.html("\n    <div id=\"map-container\">\n    </div>\n    <button class='newPics'>New Pics</button>\n    <button class='morePics'>More Pics</button>\n    ");var a=this.apiUrl+"/photos",o=document.getElementById("map-container"),i={zoom:2,center:new google.maps.LatLng(30,0),mapTypeId:google.maps.MapTypeId.ROADMAP};return this.map=new google.maps.Map(o,i),this.ajaxRequest(a,"get",null,function(n){$.each(n,function(n,a){var o=new google.maps.LatLng(a.lat,a.lng),i=new google.maps.Marker({position:o,map:t.map});google.maps.event.addListener(i,"click",function(){t.$main.append('<div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">\n          <div class="modal-dialog" role="document">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title" id="locationModalLabel"></h5>\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                  <span aria-hidden="true">&times;</span>\n                </button>\n              </div>\n              <div class="modal-body">\n                  <div class = "info-window">\n                    <img id="photoImage" src=>\n                  </div>\n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" data-dismiss="modal"> Close </button>\n              </div>\n            </div>\n          </div>\n        </div>'),$("#locationModalLabel").html(""+a.locationName),$("#photoImage").attr("src",""+a.imageOriginal),$("#infoModal").modal("show")})})})},Transit.morePics=function(){var n=this,t=this.apiUrl+"/photos";return this.ajaxRequest(t,"get",null,function(t){$.each(t,function(t,a){var o=new google.maps.LatLng(a.lat,a.lng),i=new google.maps.Marker({position:o,map:n.map});google.maps.event.addListener(i,"click",function(){n.$main.append('<div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">\n          <div class="modal-dialog" role="document">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title" id="locationModalLabel"></h5>\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                  <span aria-hidden="true">&times;</span>\n                </button>\n              </div>\n              <div class="modal-body">\n                  <div class = "info-window">\n                    <img id="photoImage" src=>\n                  </div>\n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" data-dismiss="modal"> Close </button>\n              </div>\n            </div>\n          </div>\n        </div>'),$("#locationModalLabel").html(""+a.locationName),$("#photoImage").attr("src",""+a.imageOriginal),$("#infoModal").modal("show")})})})},Transit.logout=function(n){n.preventDefault(),Transit.removeToken(),Transit.loggedOutState()},Transit.handleForm=function(n){n&&n.preventDefault();var t=""+Transit.apiUrl+$(this).attr("action"),a=$(this).attr("method"),o=$(this).serialize();return Transit.ajaxRequest(t,a,o,function(n){n.token&&Transit.setToken(n.token),Transit.loggedInState()})},Transit.ajaxRequest=function(n,t,a,o){return $.ajax({url:n,method:t,data:a,beforeSend:this.setRequestHeader.bind(this)}).done(o).fail(function(n){console.log(n)})},Transit.setRequestHeader=function(n){return n.setRequestHeader("Authorization","Bearer "+this.getToken())},Transit.setToken=function(n){return window.localStorage.setItem("token",n)},Transit.getToken=function(){return window.localStorage.getItem("token")},Transit.removeToken=function(){return window.localStorage.clear()};